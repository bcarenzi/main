<%= link_to '← Voltar para lista', movies_path, class: 'back-link' %>

<h1>Adicionar Novo Filme</h1>

<% if @movie.errors.any? %>
  <div class="error-messages">
    <h3>Erros encontrados:</h3>
    <ul>
      <% @movie.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<%= form_with model: @movie, local: true do |form| %>
  <div class="form-group">
    <%= form.label :title, "Título do Filme *" %>
    <%= form.text_field :title, placeholder: "Ex: Matrix, O Poderoso Chefão..." %>
  </div>

  <div class="form-group">
    <%= form.label :watched_at, "Data que assistiu *" %>
    <%= form.date_field :watched_at %>
  </div>

  <div class="form-group">
    <%= form.label :rating, "Avaliação (1-5 estrelas)" %>
    <div class="rating-input">
      <%= form.number_field :rating, in: 1..5, step: 1, placeholder: "1 a 5" %>
      <span class="rating-preview" id="rating-preview"></span>
    </div>
    <small style="color: #666;">Escolha de 1 a 5 estrelas</small>
  </div>

  <div class="form-group">
    <%= form.label :notes, "Notas e Observações" %>
    <%= form.text_area :notes, placeholder: "Suas impressões sobre o filme, comentários, etc..." %>
  </div>

  <div style="margin-top: 30px;">
    <%= form.submit "Salvar Filme", class: 'btn btn-success' %>
    <%= link_to 'Cancelar', movies_path, class: 'btn btn-secondary' %>
  </div>
<% end %>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const ratingInput = document.querySelector('#movie_rating');
    const ratingPreview = document.querySelector('#rating-preview');
    
    if (ratingInput && ratingPreview) {
      function updatePreview() {
        const rating = parseInt(ratingInput.value) || 0;
        if (rating > 0 && rating <= 5) {
          ratingPreview.textContent = '⭐'.repeat(rating) + '☆'.repeat(5 - rating);
        } else {
          ratingPreview.textContent = '';
        }
      }
      
      ratingInput.addEventListener('input', updatePreview);
      updatePreview();
    }
  });
</script>

